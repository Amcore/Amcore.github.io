<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Panin | promise</title>
    <meta name="description" content="重在点滴积累">
    
    
    <link rel="preload" href="/assets/css/19.styles.98f7ba2d.css" as="style"><link rel="preload" href="/assets/js/app.a25c96db.js" as="script"><link rel="preload" href="/assets/js/6.210ff5be.js" as="script"><link rel="prefetch" href="/assets/js/0.8d3f59d9.js"><link rel="prefetch" href="/assets/js/1.f04d4cbd.js"><link rel="prefetch" href="/assets/js/2.325af613.js"><link rel="prefetch" href="/assets/js/3.86e485af.js"><link rel="prefetch" href="/assets/js/4.85140464.js"><link rel="prefetch" href="/assets/js/5.c85e7d53.js"><link rel="prefetch" href="/assets/js/7.c2ef3138.js"><link rel="prefetch" href="/assets/js/8.2f700f97.js"><link rel="prefetch" href="/assets/js/9.2abe7368.js"><link rel="prefetch" href="/assets/js/10.21dc7adf.js"><link rel="prefetch" href="/assets/js/11.9e1387ba.js"><link rel="prefetch" href="/assets/js/12.a1cd0e6e.js"><link rel="prefetch" href="/assets/js/13.04d2729e.js"><link rel="prefetch" href="/assets/js/14.3f3a2c7b.js"><link rel="prefetch" href="/assets/js/15.70cd0794.js"><link rel="prefetch" href="/assets/js/16.02390579.js"><link rel="prefetch" href="/assets/js/17.de77b082.js"><link rel="prefetch" href="/assets/js/18.836b36dc.js">
    <link rel="stylesheet" href="/assets/css/19.styles.98f7ba2d.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div><a href="/" class="home-link router-link-active"><!----><span class="site-name">
      Panin
    </span></a><div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""><!----></div><nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">目录</span><span class="arrow right"></span></a><ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----><a href="/" class="nav-link">Home</a></li><li class="dropdown-item"><h4>Vue</h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/vue/" class="nav-link">Vue</a></li><li class="dropdown-subitem"><a href="/vue/binding.html" class="nav-link">双向绑定原理</a></li><li class="dropdown-subitem"><a href="/vue/render.html" class="nav-link">render函数</a></li></ul></li><li class="dropdown-item"><h4>HTTP</h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/http/" class="nav-link">http</a></li><li class="dropdown-subitem"><a href="/vue/status.html" class="nav-link">http转态码</a></li></ul></li><li class="dropdown-item"><h4>HTML</h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/html/box.html" class="nav-link">盒子模型</a></li><li class="dropdown-subitem"><a href="/html/meta.html" class="nav-link">meta标签</a></li></ul></li><li class="dropdown-item"><h4>工具使用</h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/git/" class="nav-link">Git原理</a></li><li class="dropdown-subitem"><a href="/git/use.html" class="nav-link">Git使用</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">你不知道的JavaScript</span><span class="arrow right"></span></a><ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----><a href="/js/this.html" class="nav-link">JS中的this</a></li><li class="dropdown-item"><!----><a href="/js/promise.html" class="nav-link router-link-exact-active router-link-active">promise</a></li><li class="dropdown-item"><!----><a href="/js/async.html" class="nav-link">async</a></li><li class="dropdown-item"><!----><a href="/js/generator.html" class="nav-link">Generator</a></li><li class="dropdown-item"><!----><a href="/js/module.html" class="nav-link">module</a></li><li class="dropdown-item"><!----><a href="/js/prototype.html" class="nav-link">原型链</a></li><li class="dropdown-item"><!----><a href="/js/call_apply.html" class="nav-link">模拟call、apply</a></li><li class="dropdown-item"><!----><a href="/js/sortAnimate.html" class="nav-link">冒泡排序动画</a></li></ul></div></div><!----></nav></div></header><div class="sidebar-mask"></div><div class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">目录</span><span class="arrow right"></span></a><ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----><a href="/" class="nav-link">Home</a></li><li class="dropdown-item"><h4>Vue</h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/vue/" class="nav-link">Vue</a></li><li class="dropdown-subitem"><a href="/vue/binding.html" class="nav-link">双向绑定原理</a></li><li class="dropdown-subitem"><a href="/vue/render.html" class="nav-link">render函数</a></li></ul></li><li class="dropdown-item"><h4>HTTP</h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/http/" class="nav-link">http</a></li><li class="dropdown-subitem"><a href="/vue/status.html" class="nav-link">http转态码</a></li></ul></li><li class="dropdown-item"><h4>HTML</h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/html/box.html" class="nav-link">盒子模型</a></li><li class="dropdown-subitem"><a href="/html/meta.html" class="nav-link">meta标签</a></li></ul></li><li class="dropdown-item"><h4>工具使用</h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/git/" class="nav-link">Git原理</a></li><li class="dropdown-subitem"><a href="/git/use.html" class="nav-link">Git使用</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">你不知道的JavaScript</span><span class="arrow right"></span></a><ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----><a href="/js/this.html" class="nav-link">JS中的this</a></li><li class="dropdown-item"><!----><a href="/js/promise.html" class="nav-link router-link-exact-active router-link-active">promise</a></li><li class="dropdown-item"><!----><a href="/js/async.html" class="nav-link">async</a></li><li class="dropdown-item"><!----><a href="/js/generator.html" class="nav-link">Generator</a></li><li class="dropdown-item"><!----><a href="/js/module.html" class="nav-link">module</a></li><li class="dropdown-item"><!----><a href="/js/prototype.html" class="nav-link">原型链</a></li><li class="dropdown-item"><!----><a href="/js/call_apply.html" class="nav-link">模拟call、apply</a></li><li class="dropdown-item"><!----><a href="/js/sortAnimate.html" class="nav-link">冒泡排序动画</a></li></ul></div></div><!----></nav><ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading open"><span>你不知道的Javascript</span><!----></p><ul class="sidebar-group-items"><li><a href="/js/" class="sidebar-link">JS</a></li><li><a href="/js/this.html" class="sidebar-link">JavaScript中的this</a></li><li><a href="/js/promise.html" class="active sidebar-link">promise</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/js/async.html" class="sidebar-link">async</a></li><li><a href="/js/generator.html" class="sidebar-link">Generator</a></li><li><a href="/js/module.html" class="sidebar-link">module</a></li><li><a href="/js/prototype.html" class="sidebar-link">原型链</a></li><li><a href="/js/call_apply.html" class="sidebar-link">模拟call、apply</a></li><li><a href="/js/sortAnimate.html" class="sidebar-link">冒泡排序动画</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>Vue</span><!----></p><ul class="sidebar-group-items"><li><a href="/vue/" class="sidebar-link">Vue</a></li><li><a href="/vue/binding.html" class="sidebar-link">Vue双向绑定</a></li><li><a href="/vue/render.html" class="sidebar-link">render函数</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>HTTP</span><!----></p><ul class="sidebar-group-items"><li><a href="/http/" class="sidebar-link">http</a></li><li><a href="/http/status.html" class="sidebar-link">http转态码</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>HTML</span><!----></p><ul class="sidebar-group-items"><li><a href="/html/box.html" class="sidebar-link">盒子模型</a></li><li><a href="/html/meta.html" class="sidebar-link">meta标签</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>工具使用</span><!----></p><ul class="sidebar-group-items"><li><a href="/git/" class="sidebar-link">Git原理</a></li><li><a href="/git/use.html" class="sidebar-link">Git使用</a></li></ul></div></li></ul></div><div class="page"><div class="content"><h3 id="含义"><a href="#含义" aria-hidden="true" class="header-anchor">#</a> 含义</h3><p>它由社区最早提出和实现，ES6将其写进了语言标准，统一了用法，原生提供了Promise对象。
所谓的Promise就是一容器，里面保存着某个未来才会结束事件的结。从语法上说，从它之中可以获取异步操作的的消息。</p><h3 id="特点"><a href="#特点" aria-hidden="true" class="header-anchor">#</a> 特点</h3><h4 id="对象不受外界所干扰。"><a href="#对象不受外界所干扰。" aria-hidden="true" class="header-anchor">#</a> 对象不受外界所干扰。</h4><p>promise对象代表一个异步操作。它有三种状态分别为Pending（进行中）、Resolved（已完成，又称 Fulfilled）和Rejected（已失败）。
只有异步操作的结果，可以决定当前是哪一种状态，任何其他操作都无法改变这个状态。
这也是Promise这个名字的由来，它的英语意思就是“承诺”，表示其他手段无法改变。</p><h4 id="状态一旦确定就不会改变"><a href="#状态一旦确定就不会改变" aria-hidden="true" class="header-anchor">#</a> 状态一旦确定就不会改变</h4><p>Promise对象的状态改变，只有两种可能：从Pending变为Resolved和从Pending变为Rejected。
只要这两种情况发生，状态就凝固了，不会再变了，会一直保持这个结果</p><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>首先，无法取消Promise，一旦新建它就会立即执行，无法中途取消</p><p>其次，如果不设置回调函数，Promise内部抛出的错误，不会反应到外部</p><p>第三，当处于Pending状态时，无法得知目前进展到哪一个阶段（刚刚开始还是即将完成）</p></div><h4 id="用法"><a href="#用法" aria-hidden="true" class="header-anchor">#</a> 用法</h4><p>Promise对象是一个构造函数，用来生成Promise实例</p><pre class="language-js"><code> <span class="token keyword">var</span> promise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token comment">/* 异步操作成功 */</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><p>Promise实例生成以后，可以用then方法分别指定Resolved状态和Reject状态的回调函数。</p><pre class="language-js"><code>promise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token punctuation">{</span>
   <span class="token comment">// success</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// failure</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><p>then方法可以接受两个回调函数作为参数。
第一个回调函数是Promise对象的状态变为Resolved时调用，第二个回调函数是Promise对象的状态变为Reject时调用。
其中，第二个函数是可选的，不一定要提供。这两个函数都接受Promise对象传出的值作为参数。</p><h4 id="实例"><a href="#实例" aria-hidden="true" class="header-anchor">#</a> 实例</h4><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">timeout</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">setTimeout</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> ms<span class="token punctuation">,</span> <span class="token string">'done'</span><span class="token punctuation">)</span>
   <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token function">timeout</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre><p>上面代码中，timeout方法返回一个Promise实例，表示一段时间以后才会发生的结果。
过了指定的时间（ms参数）以后，Promise实例的状态变为Resolved，就会触发then方法绑定的回调函数。</p><div class="tip custom-block"><p class="custom-block-title">注意</p><p>Promise新建后就会立即执行。</p></div><h4 id="promise原理实现"><a href="#promise原理实现" aria-hidden="true" class="header-anchor">#</a> promise原理实现</h4><ol><li>构造一个Promise实例需要给Promise构造函数传入一个函数。传入的函数需要有两个形参，两个形参都是function类型的参数。分别是resolve和reject</li><li>Promise上还有then方法，then 方法就是用来指定Promise 对象的状态改变时确定执行的操作，resolve 时执行第一个函数（onFulfilled），reject时执行第二个函数（onRejected）</li><li>当状态变为resolve时便不能再变为reject，反之同理。</li></ol><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">Promise</span><span class="token punctuation">(</span>executor<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> _this <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
  _this<span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token string">'pending'</span><span class="token punctuation">;</span>
  _this<span class="token punctuation">.</span>successValue <span class="token operator">=</span> undefined<span class="token punctuation">;</span>
  _this<span class="token punctuation">.</span>failValue <span class="token operator">=</span> undefined<span class="token punctuation">;</span>

  <span class="token keyword">function</span> <span class="token function">resolve</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>_this<span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token string">'pending'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      _this<span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token string">'resolved'</span><span class="token punctuation">;</span>
      _this<span class="token punctuation">.</span>successValue <span class="token operator">=</span> value<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">function</span> <span class="token function">reject</span><span class="token punctuation">(</span>reason<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>_this<span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token string">'reject'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      _this<span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token string">'rejected'</span><span class="token punctuation">;</span>
      _this<span class="token punctuation">.</span>failValue <span class="token operator">=</span> <span class="token string">'reject'</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token function">executor</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

Promise<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">then</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>onFailed<span class="token punctuation">,</span> onRejected<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> _this <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>_this<span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token string">'resolved'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">onFailed</span><span class="token punctuation">(</span>_this<span class="token punctuation">.</span>successValue<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>_this<span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token string">'rejected'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">onRejected</span><span class="token punctuation">(</span>_this<span class="token punctuation">.</span>failValue<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><h4 id="promise方法"><a href="#promise方法" aria-hidden="true" class="header-anchor">#</a> promise方法</h4><h5 id="promise-prototype-then"><a href="#promise-prototype-then" aria-hidden="true" class="header-anchor">#</a> Promise.prototype.then()</h5><p>Promise实例具有then方法，也就是说，then方法是定义在原型对象Promise.prototype上的。then方法返回的是一个新的Promise实例（注意，不是原来那个Promise实例）。因此可以采用链式写法，即then方法后面再调用另一个then方法</p><h5 id="promise-prototype-catch"><a href="#promise-prototype-catch" aria-hidden="true" class="header-anchor">#</a> promise.prototype.catch()</h5><p>Promise.prototype.catch方法是.then(null, rejection)的别名，用于指定发生错误时的回调函数。</p><h5 id="promise-all"><a href="#promise-all" aria-hidden="true" class="header-anchor">#</a> promise.all()</h5><p>Promise.all方法用于将多个Promise实例，包装成一个新的Promise实例.</p><pre class="language-js"><code><span class="token keyword">var</span> p <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span>p1<span class="token punctuation">,</span> p2<span class="token punctuation">,</span> p3<span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre><h5 id="promise-race"><a href="#promise-race" aria-hidden="true" class="header-anchor">#</a> Promise.race()</h5><p>Promise.race方法同样是将多个Promise实例，包装成一个新的Promise实例。</p><h5 id="promise-resolve"><a href="#promise-resolve" aria-hidden="true" class="header-anchor">#</a> promise.resolve()</h5><p>有时需要将现有对象转为Promise对象，Promise.resolve方法就起到这个作用。</p><pre class="language-js"><code>Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">)</span>
<span class="token comment">// 等价于</span>
<span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span>resolve <span class="token operator">=&gt;</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre><h5 id="promise-reject"><a href="#promise-reject" aria-hidden="true" class="header-anchor">#</a> promise.reject()</h5><p>Promise.reject(reason)方法也会返回一个新的 Promise 实例，该实例的状态为rejected。</p><h5 id="promise-try"><a href="#promise-try" aria-hidden="true" class="header-anchor">#</a> promise.try()</h5><p>实际开发中，经常遇到一种情况：不知道或者不想区分，函数f是同步函数还是异步操作，但是想用 Promise 来处理它。因为这样就可以不管f是否包含异步操作，都用then方法指定下一步流程，用catch方法处理f抛出的错误。一般就会采用下面的写法。</p><pre class="language-js"><code>promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span>
</code></pre></div><!----><div class="content page-nav"><p class="inner"><span class="prev">
        ← <a href="/js/this.html" class="prev">
          JavaScript中的this
        </a></span><span class="next"><a href="/js/async.html">
          async
        </a> →
      </span></p></div></div></div></div>
    <script src="/assets/js/6.210ff5be.js" defer></script><script src="/assets/js/app.a25c96db.js" defer></script>
  </body>
</html>
