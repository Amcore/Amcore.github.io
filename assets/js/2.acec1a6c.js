(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{50:function(t,n,s){t.exports=s.p+"assets/img/lifecycle.6f2c97f0.png"},57:function(t,n,s){"use strict";s.r(n);var a=[function(){var t=this,n=t.$createElement,a=t._self._c||n;return a("div",{staticClass:"content"},[a("h3",{attrs:{id:"生命周期图示"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#生命周期图示","aria-hidden":"true"}},[t._v("#")]),t._v(" 生命周期图示")]),a("hr"),a("p",[t._v("下图展示了实例的生命周期。你不需要立马弄明白所有的东西，不过随着你的不断学习和使用，它的参考价值会越来越高。\n"),a("img",{attrs:{src:s(50),alt:"vue-lifecycle"}})]),a("ul",[a("li",[a("em",[t._v("init")]),a("ul",[a("li",[a("code",[t._v("initLifecycle/Event")]),t._v("，往"),a("code",[t._v("vm")]),t._v("上挂载各种属性")]),a("li",[a("code",[t._v("callHook: beforeCreated")]),t._v(": 实例刚创建")]),a("li",[a("code",[t._v("initInjection/initState")]),t._v(": 初始化注入和 "),a("code",[t._v("data")]),t._v(" 响应性")]),a("li",[a("code",[t._v("created")]),t._v(": 创建完成，属性已经绑定， 但还未生成真实"),a("code",[t._v("dom")])]),a("li",[t._v("进行元素的挂载："),a("code",[t._v("$el / vm.$mount()")])]),a("li",[t._v("是否有"),a("code",[t._v("template")]),t._v(": 解析成"),a("code",[t._v("render function")]),t._v("\n*.vue文件: "),a("code",[t._v("vue-loader")]),t._v("会将"),a("code",[t._v("<template>")]),t._v("编译成"),a("code",[t._v("render function")])]),a("li",[a("code",[t._v("beforeMount")]),t._v(": 模板编译/挂载之前")]),a("li",[t._v("执行"),a("code",[t._v("render function")]),t._v("，生成真实的"),a("code",[t._v("dom")]),t._v("，并替换到"),a("code",[t._v("dom tree")]),t._v("中")]),a("li",[a("code",[t._v("mounted")]),t._v(": 组件已挂载")])])]),a("li",[a("code",[t._v("update")]),t._v(":\n"),a("ul",[a("li",[t._v("执行"),a("code",[t._v("diff")]),t._v("算法，比对改变是否需要触发UI更新")]),a("li",[a("code",[t._v("flushScheduleQueue")]),a("ul",[a("li",[a("code",[t._v("watcher.before")]),t._v(": 触发"),a("code",[t._v("beforeUpdate")]),t._v("钩子\t\t- "),a("code",[t._v("watcher.run()")]),t._v(": 执行"),a("code",[t._v("watcher")]),t._v("中的 "),a("code",[t._v("notify")]),t._v("，通知所有依赖项更新UI")])])]),a("li",[t._v("触发"),a("code",[t._v("updated")]),t._v("钩子: 组件已更新")])])]),a("li",[a("code",[t._v("actived / deactivated(keep-alive)")]),t._v(": 不销毁，缓存，组件激活与失活")]),a("li",[a("code",[t._v("destroy")]),t._v(":\n"),a("ul",[a("li",[a("code",[t._v("beforeDestroy")]),t._v(": 销毁开始")]),a("li",[t._v("销毁自身且递归销毁子组件以及事件监听\n"),a("ul",[a("li",[a("code",[t._v("remove()")]),t._v(": 删除节点")]),a("li",[a("code",[t._v("watcher.teardown()")]),t._v(": 清空依赖")]),a("li",[a("code",[t._v("vm.$off()")]),t._v(": 解绑监听")])])])])]),a("li",[a("code",[t._v("destroyed")]),t._v(": 完成后触发钩子")])]),a("p",[t._v("上面是vue的声明周期的简单梳理，接下来我们直接以代码的形式来完成vue的初始化")]),a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{attrs:{class:"token class-name"}},[t._v("Vue")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),a("span",{attrs:{class:"token comment"}},[t._v("// 初始化Vue实例")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("_init")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),a("span",{attrs:{class:"token comment"}},[t._v("// 挂载属性")]),t._v("\n  "),a("span",{attrs:{class:"token function"}},[t._v("initLifeCycle")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("vm"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" \n  "),a("span",{attrs:{class:"token comment"}},[t._v("// 初始化事件系统，钩子函数等")]),t._v("\n  "),a("span",{attrs:{class:"token function"}},[t._v("initEvent")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("vm"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" \n  "),a("span",{attrs:{class:"token comment"}},[t._v("// 编译slot、vnode")]),t._v("\n  "),a("span",{attrs:{class:"token function"}},[t._v("initRender")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("vm"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" \n  "),a("span",{attrs:{class:"token comment"}},[t._v("// 触发钩子")]),t._v("\n  "),a("span",{attrs:{class:"token function"}},[t._v("callHook")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("vm"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'beforeCreate'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{attrs:{class:"token comment"}},[t._v("// 添加inject功能")]),t._v("\n  "),a("span",{attrs:{class:"token function"}},[t._v("initInjection")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("vm"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{attrs:{class:"token comment"}},[t._v("// 完成数据响应性 props/data/watch/computed/methods")]),t._v("\n  "),a("span",{attrs:{class:"token function"}},[t._v("initState")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("vm"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{attrs:{class:"token comment"}},[t._v("// 添加 provide 功能")]),t._v("\n  "),a("span",{attrs:{class:"token function"}},[t._v("initProvide")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("vm"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{attrs:{class:"token comment"}},[t._v("// 触发钩子")]),t._v("\n  "),a("span",{attrs:{class:"token function"}},[t._v("callHook")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("vm"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'created'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{attrs:{class:"token comment"}},[t._v("// 挂载节点")]),t._v("\n  "),a("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("vm"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("$options"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("el"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    vm"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("$mount")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("vm"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("$options"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("el"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{attrs:{class:"token comment"}},[t._v("// 挂载节点实现")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("mountComponent")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("vm"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{attrs:{class:"token comment"}},[t._v("// 获取 render function")]),t._v("\n  "),a("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token operator"}},[t._v("!")]),a("span",{attrs:{class:"token keyword"}},[t._v("this")]),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("options"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("render"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{attrs:{class:"token comment"}},[t._v("// template to render")]),t._v("\n    "),a("span",{attrs:{class:"token comment"}},[t._v("// Vue.compile = compileToFunctions")]),t._v("\n    "),a("span",{attrs:{class:"token keyword"}},[t._v("let")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" render "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("compileToFunctions")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" \n    "),a("span",{attrs:{class:"token keyword"}},[t._v("this")]),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("options"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("render "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" render\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{attrs:{class:"token comment"}},[t._v("// 触发钩子")]),t._v("\n  "),a("span",{attrs:{class:"token function"}},[t._v("callHook")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'beforeMounte'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{attrs:{class:"token comment"}},[t._v("// 初始化观察者")]),t._v("\n  "),a("span",{attrs:{class:"token comment"}},[t._v("// render 渲染 vdom， ")]),t._v("\n  vdom "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" vm"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("render")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{attrs:{class:"token comment"}},[t._v("// update: 根据 diff 出的 patchs 挂载成真实的 dom ")]),t._v("\n  vm"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("_update")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("vdom"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{attrs:{class:"token comment"}},[t._v("// 触发钩子  ")]),t._v("\n  "),a("span",{attrs:{class:"token function"}},[t._v("callHook")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("vm"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'mounted'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{attrs:{class:"token comment"}},[t._v("// 更新节点实现")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("queueWatcher")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("watcher"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{attrs:{class:"token function"}},[t._v("nextTick")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("flushScheduleQueue"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{attrs:{class:"token comment"}},[t._v("// 清空队列")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("flushScheduleQueue")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t "),a("span",{attrs:{class:"token comment"}},[t._v("// 遍历队列中所有修改")]),t._v("\n  "),a("span",{attrs:{class:"token keyword"}},[t._v("for")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{attrs:{class:"token comment"}},[t._v("// beforeUpdate")]),t._v("\n    watcher"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("before")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{attrs:{class:"token comment"}},[t._v("// 依赖局部更新节点")]),t._v("\n    watcher"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("update")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" \n    "),a("span",{attrs:{class:"token function"}},[t._v("callHook")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'updated'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{attrs:{class:"token comment"}},[t._v("// 销毁实例实现")]),t._v("\nVue"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("prototype"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function-variable function"}},[t._v("$destory")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("function")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),a("span",{attrs:{class:"token comment"}},[t._v("// 触发钩子")]),t._v("\n  "),a("span",{attrs:{class:"token function"}},[t._v("callHook")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("vm"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'beforeDestory'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{attrs:{class:"token comment"}},[t._v("// 自身及子节点")]),t._v("\n  "),a("span",{attrs:{class:"token function"}},[t._v("remove")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" \n  "),a("span",{attrs:{class:"token comment"}},[t._v("// 删除依赖")]),t._v("\n  watcher"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("teardown")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" \n  "),a("span",{attrs:{class:"token comment"}},[t._v("// 删除监听")]),t._v("\n  vm"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("$off")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" \n  "),a("span",{attrs:{class:"token comment"}},[t._v("// 触发钩子")]),t._v("\n  "),a("span",{attrs:{class:"token function"}},[t._v("callHook")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("vm"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'destoryed'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n复制代码\n\n")])])])}],o=s(0),c=Object(o.a)({},function(){this.$createElement;this._self._c;return this._m(0)},a,!1,null,null,null);n.default=c.exports}}]);